"use strict";var TweenCanvas={defaults:{width:0,height:0,fill:0,canvas:0,tempCanvas:0,ctx:0,tempctx:0,paused:!1,objects:[],preload:[],idCount:0},create:function(a,b,c){return this.defaults.width=a,this.defaults.height=b,c&&(this.defaults.fill=c),this.defaults.canvas=document.createElement("canvas"),this.defaults.tempCanvas=document.createElement("canvas"),this.defaults.canvas.width=a,this.defaults.canvas.height=b,this.defaults.canvas.style.position="absolute",this.defaults.tempCanvas.width=a,this.defaults.tempCanvas.height=b,this.defaults.ctx=this.defaults.canvas.getContext("2d"),this.defaults.tempctx=this.defaults.tempCanvas.getContext("2d"),this.rafFix(),this.defaults.canvas},rafFix:function(){for(var a=0,b=["webkit","moz"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})},extend:function(a,b){for(var c in b)if("object"!=typeof b[c]||Array.isArray(b[c]))b.hasOwnProperty(c)&&(a[c]=b[c]);else for(var d in b[c])b[c].hasOwnProperty(d)&&(a[c][d]=b[c][d]);return a},createEmptyObject:function(a){var b={id:0,x:0,y:0,scaleX:1,scaleY:1,centerX:0,centerY:0,transformOrigin:"",rotation:0,alpha:1,mask:[],invertMask:!1,blendmode:"source-over",filter:"none"};return a.imageObj&&(b.imageObj={url:0,src:0}),a.pointObj&&(b.pointObj={points:[],closePath:!0,fill:{color:"white"},stroke:0}),a.textObj&&(b.textObj={text:0,font:"Arial",fontSize:10,lineHeight:0,textWidth:0,textHeight:0,textAlign:"left",lines:[],fill:{color:"white"},stroke:0,fontLoaded:0,bitmapText:0,bitMap:0}),a.arcObj&&(b.arcObj={radius:0,startAngle:0,endAngle:0,counterclockwise:!1,stroke:{color:"white",width:0}}),b=this.extend(b,a||{})},createObject:function(a){var b=this.createEmptyObject(a);return b.imageObj||b.textObj?this.defaults.preload.push(b):this.calcCenter(b),b.id||(b.id=this.defaults.idCount++),b.textObj&&(b.textObj.lines=b.textObj.text.split("<br>"),b.textObj.lineHeight||(b.textObj.lineHeight=b.textObj.fontSize)),this.defaults.objects.push(b),b},deleteObject:function(a){for(var b=0;b<this.defaults.objects.length;b++)if(this.defaults.objects[b].id===a.id){this.defaults.objects.splice(b,1);break}},setMask:function(a,b){for(var c=0;c<this.defaults.objects.length;c++)if(this.defaults.objects[c].id===b.id){a.mask.push(this.defaults.objects.splice(c,1)[0]);break}},preload:function(a){var b=this;if(this.defaults.preload.length){var c=this.defaults.preload.pop();if(c.imageObj){var d=new Image;d.onload=function(){c.imageObj.src=this,b.calcCenter(c),b.preload(a)},d.onerror=function(){console.warn("Image doesnt exist: "+this.src),b.preload(a)},d.src=c.imageObj.url}if(c.textObj){var e=this.createTextMeasuringObj(c);document.body.appendChild(e);var f=setInterval(function(){if(b.defaults.ctx.font=c.textObj.fontSize+"pt "+c.textObj.font,b.fontLoaded(e,c.textObj.font)){if(clearInterval(f),c.textObj.textWidth=e.clientWidth,c.textObj.textHeight=e.clientHeight,c.textObj.fontLoaded=!0,document.body.removeChild(e),c.textObj.bitmapText){b.defaults.tempCanvas.width=c.textObj.textWidth,b.defaults.tempCanvas.height=c.textObj.textHeight;var d={id:0,x:0,y:0,scaleX:1,scaleY:1,centerX:0,centerY:0,rotation:0,alpha:1,textObj:c.textObj};b.drawObject(d,b.defaults.tempctx);var g=new Image;g.src=b.defaults.tempCanvas.toDataURL(),c.textObj.bitMap=g,b.defaults.tempctx.clearRect(0,0,b.defaults.width,b.defaults.height),b.defaults.tempCanvas.width=b.defaults.width,b.defaults.tempCanvas.height=b.defaults.height}c.transformOrigin&&b.setTransformOrigin(c),b.preload(a)}},100)}}else a&&a()},calcCenter:function(a){if(a.pointObj){for(var b=a.pointObj.points.length,c=-(1/0),d=-(1/0),e=1/0,f=1/0;b--;)a.pointObj.points[b][0]>c&&(c=a.pointObj.points[b][0]),a.pointObj.points[b][1]>d&&(d=a.pointObj.points[b][1]),a.pointObj.points[b][0]<e&&(e=a.pointObj.points[b][0]),a.pointObj.points[b][1]<f&&(f=a.pointObj.points[b][1]);a.centerX=(c+e)/2,a.centerY=(d+f)/2,a.transformOrigin&&this.setTransformOrigin(a)}a.arcObj&&(a.centerX=a.centerY=a.arcObj.radius/2,a.transformOrigin&&this.setTransformOrigin(a)),a.imageObj&&(a.centerX=a.imageObj.src.width/2,a.centerY=a.imageObj.src.height/2,a.transformOrigin&&this.setTransformOrigin(a)),a.textObj&&(a.centerX=a.textObj.textWidth/2,a.centerY=a.textObj.textHeight/2)},createTextMeasuringObj:function(a){var b=document.createElement("span");return b.style.width="auto",b.style.height="auto",b.style.display="inline-block",b.style.whiteSpace="nowrap",b.style.position="absolute",b.style.fontFamily=a.textObj.font,b.style.fontSize=a.textObj.fontSize+"pt",b.style.lineHeight=a.textObj.lineHeight+"pt",b.style.top="-3000px",b.style.left="-3000px",b.style.color="black",b.style.border="1px solid red",b.innerHTML=a.textObj.text,b},setTransformOrigin:function(a){var b=a.transformOrigin.replace(/%/gi,""),c=b.split(" ");2!=c.length||isNaN(Number(c[0]))||isNaN(Number(c[1]))?console.warn("transformOrigin values incorrect: "+a.transformOrigin):(a.centerX=Number(c[0])/100*a.centerX*2,a.centerY=Number(c[1])/100*a.centerY*2)},fontLoaded:function(a,b){for(var c=["serif","sans-serif","monospace","cursive","fantasy"],d=0,e=0,f=0;f<c.length;++f){if(a.style.fontFamily='"'+b+'",'+c[f],d=a.offsetWidth,f>0&&d!=e)return!1;e=d}return!0},clear:function(){this.defaults.ctx.clearRect(0,0,this.defaults.width,this.defaults.height)},listObjects:function(){for(var a=0;a<this.defaults.objects.length;a++)console.log(this.defaults.objects[a])},render:function(){if(!this.defaults.paused){var a=this;this.clear(),this.defaults.ctx.save(),this.defaults.fill&&(this.defaults.ctx.fillStyle=this.defaults.fill,this.defaults.ctx.fillRect(0,0,this.defaults.width,this.defaults.height)),this.defaults.ctx.restore();for(var b=0;b<this.defaults.objects.length;b++)this.defaults.ctx.save(),this.defaults.objects[b].mask.length?(this.defaults.tempctx.clearRect(0,0,this.defaults.width,this.defaults.height),this.defaults.objects[b].mask.forEach(function(b,c){a.defaults.tempctx.save(),a.drawObject(b,a.defaults.tempctx),a.defaults.tempctx.restore()}),this.defaults.objects[b].invertMask?this.defaults.tempctx.globalCompositeOperation="source-out":this.defaults.tempctx.globalCompositeOperation="source-in",this.defaults.tempctx.save(),this.drawObject(this.defaults.objects[b],this.defaults.tempctx),this.defaults.tempctx.restore(),this.defaults.ctx.globalCompositeOperation=this.defaults.objects[b].blendmode,this.defaults.ctx.drawImage(this.defaults.tempCanvas,0,0),this.defaults.tempctx.globalCompositeOperation="source-over",this.defaults.ctx.globalCompositeOperation="source-over"):(this.defaults.ctx.globalCompositeOperation=this.defaults.objects[b].blendmode,this.defaults.ctx.filter=this.defaults.objects[b].filter,this.drawObject(this.defaults.objects[b],this.defaults.ctx),this.defaults.ctx.filter="none",this.defaults.ctx.globalCompositeOperation="source-over"),this.defaults.ctx.restore();window.requestAnimationFrame(this.render.bind(this))}},drawObject:function(a,b){if(b.translate(a.x+a.centerX,a.y+a.centerY),b.rotate(a.rotation*Math.PI/180),b.scale(a.scaleX,a.scaleY),b.translate(-a.centerX,-a.centerY),b.globalAlpha=a.alpha,a.pointObj){b.beginPath(),b.moveTo(a.pointObj.points[0][0],a.pointObj.points[0][1]);for(var c=1;c<a.pointObj.points.length;c++)b.lineTo(a.pointObj.points[c][0],a.pointObj.points[c][1]);a.pointObj.closePath&&b.closePath(),a.pointObj.fill&&(a.pointObj.fill.gradient?b.fillStyle=this.gradient(a.pointObj.fill.gradient,b):b.fillStyle=a.pointObj.fill.color,b.fill()),a.pointObj.stroke&&(a.pointObj.stroke.gradient?b.strokeStyle=this.gradient(a.pointObj.fill.gradient,b):b.strokeStyle=a.pointObj.stroke.color,b.lineWidth=a.pointObj.stroke.width,b.stroke())}a.arcObj&&(b.beginPath(),b.arc(0,0,a.arcObj.radius,a.arcObj.startAngle/180*Math.PI,a.arcObj.endAngle/180*Math.PI,a.arcObj.counterclockwise),a.arcObj.fill&&(a.arcObj.fill.gradient?b.fillStyle=this.gradient(a.arcObj.fill.gradient,b):b.fillStyle=a.arcObj.fill.color,b.fill()),a.arcObj.stroke&&(a.arcObj.stroke.gradient?b.strokeStyle=this.gradient(a.arcObj.stroke.gradient,b):b.strokeStyle=a.arcObj.stroke.color,b.lineWidth=a.arcObj.stroke.width,b.stroke())),a.textObj&&a.textObj.fontLoaded&&(a.textObj.bitMap?b.drawImage(a.textObj.bitMap,0,0,a.textObj.bitMap.width,a.textObj.bitMap.height):(b.font=a.textObj.fontSize+"pt "+a.textObj.font,b.textBaseline="alphabetic",b.textAlign=a.textObj.textAlign,a.textObj.fill&&(b.fillStyle=a.textObj.fill.color),a.textObj.stroke&&(b.strokeStyle=a.textObj.stroke.color,b.lineWidth=a.textObj.stroke.width),a.textObj.lines.forEach(function(c,d){a.textObj.fill&&("left"===a.textObj.textAlign&&b.fillText(c,0,(d+1.25)*a.textObj.lineHeight),"center"===a.textObj.textAlign&&b.fillText(c,a.textObj.textWidth/2,(d+1)*a.textObj.lineHeight),"right"===a.textObj.textAlign&&b.fillText(c,a.textObj.textWidth,(d+1)*a.textObj.lineHeight)),a.textObj.stroke&&("left"===a.textObj.textAlign&&b.strokeText(c,0,(d+1.25)*a.textObj.lineHeight),"center"===a.textObj.textAlign&&b.strokeText(c,a.textObj.textWidth/2,(d+1)*a.textObj.lineHeight),"right"===a.textObj.textAlign&&b.strokeText(c,a.textObj.textWidth,(d+1)*a.textObj.lineHeight))}))),a.imageObj&&b.drawImage(a.imageObj.src,0,0,a.imageObj.src.width,a.imageObj.src.height)},gradient:function(a,b){var c;return"radial"==a.type&&(c=b.createRadialGradient(a.startX,a.startY,a.startRadius,a.endX,a.endY,a.endRadius),a.colorStop.forEach(function(b,d){c.addColorStop(a.colorStop[d][0],a.colorStop[d][1])})),"linear"==a.type&&(c=b.createLinearGradient(a.startX,a.startY,a.endX,a.endY),a.colorStop.forEach(function(b,d){c.addColorStop(a.colorStop[d][0],a.colorStop[d][1])})),c},pause:function(){this.defaults.paused=!0,window.cancelAnimationFrame(this.render)},start:function(){this.defaults.paused=!1,window.requestAnimationFrame(this.render.bind(this))}};